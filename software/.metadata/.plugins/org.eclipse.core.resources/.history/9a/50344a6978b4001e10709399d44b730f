
#include "system.h"
#include "altera_avalon_pio_regs.h"
#include "sys/alt_stdio.h"
#include "sys/unistd.h"
#include "sys/time.h"
#include <sys/alt_irq.h>
#include <io.h>
#include "sys/alt_sys_init.h"


volatile int delay= 1000000; //init global à 1 sec

volatile alt_u16 cpt=0x0F;

static void irqhandler (void * context, alt_u32 id)
{
	alt_u8 Switch_button=IORD_ALTERA_AVALON_PIO_DATA(PIO_0_BASE);
	delay= delay/Switch_button;
	alt_printf('h');

}

int main(void) {



	alt_irq_register( PUSHBUTTON_TRIGGER_BASE, NULL, (void*)irqhandler );
	for(;;)
			{if(IORD_ALTERA_AVALON_PIO_DATA(PIO_0_BASE)==0)
			{
				for( alt_u8 i=0; i<10;i++)
				{

					IOWR_ALTERA_AVALON_PIO_DATA(LED_OUT_BASE,cpt);
					usleep(delay);
					IOWR_ALTERA_AVALON_PIO_DATA(LED_OUT_BASE,0x00);
					usleep(delay);
					cpt=cpt<<1;
				}
				cpt=0x0F;
			}
			}





    return 0;
}
